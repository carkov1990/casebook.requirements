
# СОЮ / Календарь 

**Задачи**: [Epic](https://jira.parcsis.org/browse/CBAPP-5077) / [UserStory](https://product.case.one/#/case/1796c49a-dd67-1487-de63-b00c0098367b/view/)

**Команда**: Чугункина Алена / Аналитик, Царьков Сергей / Архитектор  

**Дата:** 10 ноября 2023


## Краткий обзор потребности

### Заинтересованные стороны

* ООО "БАШЮРИСТ"  (Предположительно Casebook необходим для outsource юристов)
* ООО СТРАХОВАЯ КОМПАНИЯ "ГЕЛИОС" (Предположительно Casebook необходим для inhouse юристов)
* ООО "СЭРК" (Предположительно Casebook необходим для outsource юристов)

### Причина отказа

Полученные данные от "продавцов": Нет календаря дел СОЮ. Клиенты занимаются делами общей юрисдикции. 
Данный отзыв по всем трем клиентам.

### Потребность

На основании информации полученной от "продавцов" можно сделать вывод, что для данных клиентов стоит острая необходимость видеть список заседаний по делам, которые в работе у юристов. Сотрудник клиента должен видеть: ближайшее событие-заседание, по какому делу это заседание и когда оно должно пройти.

### Бизнес цель
На основании причины отказа и выявленной потребности можно выделить бизнес цель:

**Я, КАК**
пользователь Casebook,

**ХОЧУ**
видеть в календаре заседаний, в карточке организации предстоящие заседания СОЮ,

**ЧТОБЫ**
было удобно отслеживать свои судебные заседания СОЮ

## Исследования
В рамках приоритетного направления - *доработка СОЮ*, произведен ресерч наличия в данных из АПИ СОЮ информации о *будущих судебных заседаниях* по делам СОЮ.
Статистика наличия событий в делах СОЮ на 20 июля 2023:

|Наименование типа события | Количество событий | Количество дел |
|---|---|---|
|Вынесение финального решения | 115383850 | 80570668 |
|**Назначение заседания**| **30338979** | **26154716** |
|Оставление без движения|	11045283|	10645235|
|Возвращение	|10859596	|9688560|
|Приостановление	|7278406|	6442332|
|Возобновление	|5742140|	5235513|
|Подача жалобы	|691312|	672813|

**Хорошо бы получить пример как собирали статистику**

Пример дела с будущим заседанием: [2a-12606/2023](https://krasnodar-prikubansky--krd.sudrf.ru/modules.php?name=sud_delo&name_op=case&case_id=275663997&case_uid=19d7897e-8f8a-4b72-af62-64a4edbf301d&delo_id=41&case_type=0&new=0&srv_num=1)

**Хорошо бы иметь скрин или страницу с информацией, которую пытаетесь донести. Здесь заседание уже прошло и не видно, что вы хотели показать**

Маппинг событий СОЮ : [Метод](https://docs.google.com/spreadsheets/d/16y2yk4-BLQGJNC8eMrLTF-1DbjSJKCqKXZFiEKj5nVU/edit#gid=0) 

**Из какого метода надо написать**

## Предлагаемое решение

### Карточка дела СОЮ

#### Use case
**Юрист-судебник**, специализирующийся на ведении судебных дел в судах общей юрисдикции, заходит в карточку дела СОЮ и видит информацию о наличии/отсутствии будующих судебных заседаний в просматриваемом деле чтобы:

* Своевременно подготовится к участию в деле в качестве представителя (написать позицию по делу)
* Подготовить процессуальные документы для участия в деле и заблаговременно направить их копии сторонам, участвующим в деле

![GJCard](./GJCard.png)

В карточке СОЮ находится блок "Ближайшие заседания". Блок находится до блока "Участники" и после блока "Общая информация".

Состав блока:
|Ближайшие заседания| | | |
|---|---|---|---|
|Дата и время судебного заседания (формат ЧЧ:ММ, ДД.ММ.ГГГГ) | ФИО судьи (формат Фамилия И.О.) | Наименование суда. Наименование события (Например - Судебное заседание, Предварительное судебное заседание, Беседа и тд.) |Кнопка "Готовность", Кнопка "ПДФ", Кнопка "Я иду"|

В случае, если судебных заседаний нет, то отображается заголовок "Ближайших заседаний нет".
В качестве судебных заседаний для отображения используются события = будущим судебным заседаниям (т.е. те, которые еще не прошли) в таблице на вкладке ["Назначение заседания"](https://docs.google.com/spreadsheets/d/16y2yk4-BLQGJNC8eMrLTF-1DbjSJKCqKXZFiEKj5nVU/edit#gid=0)

**Из какого метода CSL это брать**

### Календарь заседаний
#### Use case
**Юрист-судебник**, специализирующийся на ведении судебных дел в судах общей юрисдикции, открывает календарь заседаний ознакамливается с информацией по наличию/отсутствию судебных заседаний по делам СОЮ чтобы:

* Вести учет своих судебных заседаний за определенный период времени (неделя, месяц, квартал и тд)
* Запланировать участие в судебных заседаниях на определенный период времени (неделя, месяц, квартал и тд)
* В случае наличия пересечений в судебных заседаниях, подготовить процессуальный документ в суд либо попросить коллегу поучавствовать 
* Отметить факт своего участия/подготовки в судебном заседании

**Руководитель юридического отдела**, специализирующегося на ведении судебных дел в судах общей юрисдикции, открывает календарь заседаний, фильтрует календарь по фильтру "Готовность" чтобы:

* Проверить ко всем ли судебным заседаниям готовы его подчиненные

1. Создание нового календаря

При создании нового календаря/редактировании ранее созданного календаря заседаний пользователь может выбрать подборки СОЮ и судебные дела СОЮ.

При выборе подборки в дропдауне пользователю доступны для выбора имеющиеся у него подборки СОЮ.

При добавлении атрибутов отслеживания судебных заседаний пользователю доступны атрибуты для отслеживания судебных заседаний по делам СОЮ, такие как:

* Номер дела
* Суд в деле СОЮ
* Вид спора СОЮ
* Дата регистрации дела СОЮ
* Участник дела СОЮ

![Calendar1](./calendar1.png)

![Calendar2](./calendar2.png)

При нажатии кнопки ![arrow](./arrow.png) открывается окно со следующим составом данных:

* Номер дела (кликабельный, при нажатии переход на карточку дела)
* Дата заседания в формате ДД.ММ.ГГГГ
* Запланированное время заседания в формате ЧЧ.ММ
* Суд
* Судья
![session](./session.png)

2. Фильтрация и сортировка календаря заседаний.

При просмотре календаря заседаний пользователь может отфильтровать результат исходя из принадлежности судебного заседания к арбитражному делу или к делу СОЮ.

### Предположительная нагрузка

Средний ожидаемый RPS - 0,400 запросов в секунду. 

Пиковый ожидаемый RPS - 15 запросов в секунду. 

P95 среднее время ответа - 800 ms.

Максимально допустимое время ответа (SLA) - 2s.

**На основании каких данных был произведен расчет?**

### Предварительная оценка
**Ближайшие заседания**
По задаче [CSL-11738](https://jira.parcsis.org/browse/CSL-11738) команда Caselook добавила в ответ метода [/api/GeneralJurisdiction/AdvancedSearch](http://search2.cl-prod-lb.kad.local/api-docs/v1/#/%D0%9E%D0%B1%D1%89%D0%B0%D1%8F%20%D1%8E%D1%80%D0%B8%D1%81%D0%B4%D0%B8%D0%BA%D1%86%D0%B8%D1%8F%3A%20%D0%B2%D0%BD%D1%83%D1%82%D1%80%D0%B5%D0%BD%D0%BD%D0%B5%D0%B5%20API/post_api_GeneralJurisdiction_AdvancedSearch) дополнительные поля

```"events": [
        {
          "baseOfResultEvent": "string", основания результата для события
          "date": "string",
          "name": "string",
          "placeOfEvent": "string", место проведения
          "result": "string"
        }
      ]
```
Для того чтобы отобразить ближайшие заседания из [Карточка дела СОЮ](#карточка-дела-сою) не понятно откуда брать Судью, Этаж, Кабинет, Суд. Возможно из placeOfEvent, но тогда возникает вопрос как их парсить. Возможно там есть какое то правило парса, если нет, то как показано на прототипе не получится, если да, то нужно проанализировать правило.

Кнопка готовность, PDF, Информация и Я иду. Для того чтобы изменить степень говотности по заседанию на текущий момент используется метод *UserData/CaseSessions/SaveState* в который передается Идентификатор дела, Идентификатор заседания и степень готовности. CL в своем методе не отдает Id события, то есть нет идентификатора по которому нужно изменить готовность. Тоже самое относится и к другим кнопкам.

**Календарь**
В текущем варианте реализации календаря необходимо будет дорабатывать *Создание календаря*, а так же сводный календарь - группировать информацию из 2х источников. 
Для получения заседаний по делу СОЮ, нужно будет из подборки получить все отслеживаемые дела и в цикле по каждому делу/либо по пачке дел получить всю информацию. Из ответа вытащить только информацию по заседанию и отдать на фронт. При этом фильтры готовности и я иду не будут работать из за отсутсвия идентификаторов.

**Риски**
|№| Описание| Критичность |
|---|---|---|
|1| Несоответствие данных из CL визуализации из прототипа| Высокая |
|2| Отсутствие метода CL для получения информации о заседаниях| Высокая |
|3| Апи работы с календарем находится в монолите Cb| Средняя |

**Итог**
На текущий момент полный список предварительных требований реализовать невозможно.

## Альтернативное решение

### Карточка дела СОЮ
Карточка дела реализуется так же как и в первом предложенном решении. 
По запросу от фронта сервис постредник Casebook, отправляет запрос к AdvancedSerach методу Caselook. Тот в свою очередь возвращает в ответ **полную** информацию по делу. В этой информации содержится массив events, в котором и находятся ближайшие заседания.

### Карточка организации, вкладка заседания
Реализация данной вкладки затрудняется хронологией. То есть хорошо бы было показывать заседания в хронологическом порядке. К сожалению на текущий момент для этого у Caselook не существует метода, но если они реализуют в AdvancedSearch фильтр по EventType и фильтрацию о дате события, то можно будет реализовать и хронологию. На данный момент, я предлагаю выводить данные без хронологического порядка событий - сортировку можно реализовать по дате дел.

### Календарь
Предположительно календарь СОЮ можно реализовать отдельным "Сводным календарем". Т.е. отдельной вкладкой. Это позволит не пересекаться фильтрам календарей арбитража и СОЮ, что усложняет задачу. В календаре СОЮ предположительно можно показывать все заседания за N месяцев назад и M записей распаршенных Caselook. Откуда брать информацию: так как в Caselook нет календаря заседаний и отдельной сущности заседание, то решение является не совсем простым и логичным, с нарушением паттерна GRASP **Information Expert**. Между Casebook и Caselook реализована связь через очередь RabbitMq. По данной шине Caselook передает данные Casebook о том какое дело или событие появилось в деле. Соответственно, получая эти данные, мы можем переносить их в хранилище календаря, которое будет содержать данные позволяющие идентифицировать событие в Caselook и построить календарь(Дата события, Название события, Идентификатор дела и т.п.). Уникальная идентификация позволит получить расширенные данные из Caselook.
Данный подход может позволить реализовать функциональность "Готовность" и "Я иду", но к сожалению "PDF" реализовать не удастся.


### Предварительная оценка
**Карточка дела СОЮ**
На фронте необходимо реализовать новый UI элемент.
На бэке необходимо поправить маппинг и возможно для удобства реализовать отдельную сущность "Заседания" в ответе на фронт.

**Карточка организации, вкладка заседания**
На фронте нужно реализовать отдельную вкладку Заседания СОЮ
На бэке нужно реализовать отдельный метод отдающий список заседаний в ответ

**Календарь**
На фронте нужно реализовать отдельную UI сущность "Календарь СОЮ"
На бэке нужно реализовать:
* Процесс формирования хранилища
* Процесс очистки хранилища за N+1 месяц
* Метод выдачи календаря на фронт
* Методы для функционала "Готовность" и "Я иду"

**Итог** предварительная оценка данной задачи равна **M-L**


## Принятое решение
> Описание на основании чего было принято решение и какое именно

## Требования
> В этом разделе рассматриваются конкретные требования к проекту, кто в нем участвует и контекст, в котором решение будет разработано и предоставлено. То есть тот минимальный функционал, который должен покрыть потребности

### Функциональные требования
> Описывает конкретные функциональные возможности, которые система должна предоставлять в четких, выполнимых терминах. API, Задачи и т.д. 

### Нефункциональные требования
> Охватывает качество или критерии функционирования системы, такие как производительность, масштабируемость и безопасность.

### Ограничения
> Перечисляются ограничения, в рамках которых должна работать команда проекта, такие как технологические, финансовые или временные ограничения.

### Риски
>Этот раздел описывает потенциальные риски, которые могут повлиять на успешную реализацию или функционирование решения. Риски следует регулярно пересматривать, переоценивать и обновлять по мере продвижения проекта. Для каждого риска следует предоставить стратегии смягчения и реагирования.
